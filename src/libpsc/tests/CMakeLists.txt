
macro(add_psc_test name)
  if(GTEST_FOUND)
    add_executable(${name} ${name}.cxx)
    target_link_libraries(${name} psc GTest::GTest GTest::Main)
    gtest_discover_tests(${name})
    if (ADIOS2_FOUND)
      target_link_libraries(${name} adios2::adios2)
    endif()
  endif()
endmacro()

add_psc_test(vec3_unittest)
add_psc_test(test_grid)
add_psc_test(test_grid_2)
add_psc_test(test_rng)
add_psc_test(test_mparticles_cuda)
add_psc_test(test_mparticles)
add_psc_test(test_output_particles)
add_psc_test(test_mfields)
add_psc_test(test_bnd)
add_psc_test(test_push_particles)
add_psc_test(test_push_particles_2)
add_psc_test(test_push_fields)
add_psc_test(test_moments)
add_psc_test(test_collision)
add_psc_test(test_inject)
add_psc_test(test_balance)

if (ADIOS2_FOUND)
  add_psc_test(test_kg_io)
endif()

macro(add_adios_test name)
  if (ADIOS2_FOUND)
    add_executable(${name} ${name}.cxx)
    target_compile_features(${name} PUBLIC cxx_std_14)
    target_link_libraries(${name} adios2::adios2 MPI::MPI_C)
  endif()
endmacro()

add_adios_test(test_adios2)
add_adios_test(test_adios2_local_single_value)
